# Теория

## 1) Виды Graph RAG’ов

**Графы знаний** бывают двух видов: **сущностные** и **контекстные**.

### Сущностный граф знаний
Сущностный граф знаний представляет информацию через узлы и связи, где:
- **Узлы** обозначают конкретные сущности (люди, места, объекты и т.д.).
- **Связи** отражают отношения между сущностями.  
  Например:
  - Узел, представляющий человека, может быть связан с узлом, представляющим город, посредством связи «живет в», указывающей на место проживания.
  - Два узла, представляющие компании, могут быть связаны через связь «конкурент», показывая их конкурентные отношения.
  - Узел, представляющий произведение искусства, может быть связан с узлом, представляющим художника, посредством связи «создано», указывающей на автора.

В сущностных графах знаний акцент делается на конкретных сущностях и их взаимосвязях, что позволяет эффективно моделировать и анализировать сложные сети отношений в различных областях знаний.

### Контекстный граф знаний
Контекстный граф знаний — это структура данных, где:
- **Узлы** содержат исходные данные (текстовые отрывки, изображения, таблицы и т.д.).
- **Связи** отражают структурные, семантические и метаданные-свойства между этими данными.

В отличие от графов, ориентированных на сущности, где информация сокращается до простых аннотаций на ребрах, контекстные графы сохраняют полноту исходных данных, что делает их более полезными в качестве контекста для моделей LLM.

Ребра между узлами могут представлять различные типы связей:
- Фрагмент текста с гиперссылкой может быть связан с соответствующим контентом.
- Два фрагмента с общими ключевыми словами могут иметь связь, указывающую на их схожесть.
- Текстовый отрывок может ссылаться на изображение или таблицу в том же разделе.
- Отрывки в документе могут ссылаться на определения ключевых терминов.

Преимущество контекстных графов знаний заключается в том, что они позволяют строить граф до того, как известен конкретный вопрос, избегая необходимости спекулировать или использовать ручное руководство для определения значимых фактов. Это делает их более гибкими и адаптируемыми к различным задачам обработки естественного языка.

## 2) Microsoft GraphRAG

**Microsoft GraphRAG** — это метод, представленный Microsoft Research в 2024 году, который сочетает Retrieval-Augmented Generation (RAG) с графовыми структурами для улучшения обработки сложных текстовых данных. Он создан для эффективного поиска, анализа и генерации информации в неструктурированных источниках, таких как корпоративные документы и научные статьи.

### Отличительные особенности:
- Гибридный подход, совмещающий элементы контекстного и сущностного графа знаний.
- Группировка узлов в сообщества с построением иерархии, что позволяет моделям LLM лучше понимать контекст.
- Использование LLM для построения графа без явного аннотирования данных (в отличие от других решений, требующих явного указания сущностей).

### Основные шаги
#### Индексация
- **Разделение текста:** Входной корпус текста разделяется на чанки, которые выступают в роли анализируемых единиц, обеспечивая детализированные ссылки в результатах.
- **Извлечение данных:** С помощью LLM извлекаются сущности, отношения и ключевые утверждения.
- **Иерархическая кластеризация:** Граф кластеризуется с использованием метода Лейдена. Для визуализации процесса каждый круг представляет сущность (например, человека, место или организацию), его размер отражает степень значимости, а цвет – принадлежность к сообществу.
- **Генерация суммаризации:** Суммаризация создаётся для каждого сообщества и его элементов, что помогает в понимании набора данных «снизу вверх».

#### Запрос
- **Глобальный поиск:** Использует суммаризации сообществ для рассуждения о целостных вопросах, касающихся корпуса текста.
- **Локальный поиск:** Расширяет запрос до соседей и связанных концепций для конкретных сущностей.
- **DRIFT-поиск:** Похож на локальный поиск с добавлением контекста информации о сообществах.

## 3) Как делать индексацию лучше?

Нынешняя реализация Microsoft GraphRAG имеет существенный недостаток: добавление новых документов требует полной переиндексации для обновления графа знаний и поддержания актуальности данных. Это происходит, так как система изначально не предусматривает механизм инкрементального обновления индекса.

Некоторые команды разработчиков реализовали функцию, позволяющую вводить новые документы в уже существующий индекс без необходимости полной переиндексации, что сокращает время и затраты ресурсов.

### Механизм инкрементального обновления графа включает два основных этапа:
- **Извлечение и интеграция новых сущностей:**  
  При добавлении новых документов выполняется их анализ для выявления релевантных сущностей и установления между ними связей. Полученные данные интегрируются в существующий граф, что позволяет своевременно обновлять информацию.

- **Обогащение существующего графа:**  
  Проводится поиск схожих сущностей в текущем графе с последующим установлением дополнительных связей, характеризующих схожесть или синонимичность, что обеспечивает более точное представление взаимосвязей в данных.

### Алгоритмы, которые мы пробовали
#### Fast GraphRAG
**Fast GraphRAG** — это открытая библиотека, предназначенная для улучшения процессов извлечения и генерации информации с помощью графов знаний.

#### Основные особенности Fast GraphRAG:
- **Динамическое обновление данных:** Автоматическая генерация и уточнение графов в соответствии с изменениями данных и требованиями предметной области.
- **Инкрементальные обновления:** Поддержка поэтапного добавления данных, обеспечивающая гибкость и адаптивность системы.
- **Интеллектуальное исследование:** Использование метода Personalized Page Rank для оценки важности вершин в графе с учётом предпочтений пользователя. На выходе получается распределение, где вершины, близкие к запросу, имеют более высокие значения, что помогает в ранжировании и поиске релевантных фрагментов текста.
